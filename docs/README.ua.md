# php telegram api bot easy FULL

### Сумісність
Цей код перевірено на роботу з PHP 8.1.
Він також може бути сумісний із PHP 5.6, хоча це не гарантовано.

[README in english](../docs/README.en.md)  

БОТ НА ЕТАПІ ФІНАЛЬНОГО ДОКУМЕНТУВАННЯ  
ЗАРАЗ ВІН НЕ ГОТОВИЙ ДЛЯ ВИКОРИСТАННЯ  
ПЕРШИЙ РОБОЧИЙ КОМІТ ЗАПЛАНОВАНО НА 30.06.2024  

Повний набір бібліотек, класів та функцій, необхідних для створення функціонального процедурного Telegram-бота, який вільний від будь яких зовнішніх залежностей

```php
// Connection base class
include_once $_SERVER['DOCUMENT_ROOT'] . "/lib/tgBot.php";
// Get the bot object
// Вкажіть токен від botfather та ім’я бота
$bot = new tgBot($token, $name);
```

**Якщо вам ЛИШЕ потрібен клас**, який працює з API бота Telegram, і ви самостійно розроблятимете функціональні можливості бота, то все, що вам потрібно, це один файл:  

/lib/tgBot.php  

```php
// If you ONLY need a class 
// Також потрібно при кожному отриманні об'єкта активувати
// You also need to activate each time you receive an object
$bot->liteModeOn();

// АБО ЩОБ ЦЬОГО НЕ РОБИТИ КОЖЕН РАЗ, В САМОМУ КЛАСІ (!) МОЖНА ЗМІНИТИ 
// OR TO NOT DO THIS EACH TIME, YOU CAN CHANGE IN THE CLASS ITSELF  
public $FullMode = false;
```

**Приклади базового використання:**  
```php

// Ban, for example, until 2048 year (unix)
$bot->tempban($user, '2473401362');

// 


// chat_id|from_id отримувача повідомлення
$bot->for($chat_id);
/* 
Раніше додана клавіатура видаляється автоматично після відправки повідомлення,
тож для нового повідомлення її потрібно вказувати знову або якщо потрібно зберегти клавіатуру, 
то ДО відправки кожного повідомлення можна вказати: 
*/
$bot->clearKeyboardAfterSend = false;
// Send message
// Після відправки ми можемо розібрати масив з відповідю
$response = $bot->reply("Hello World");



```


По замовчуванню кожен запит для зручного дебагінгу логується в текстові файли в папку bots/nameBot/  
Для відключення логування **вхідних** закоментуйте в bots/base_hook.php рядок $bot->botLog(...);  
Для відключення логування **вихідних** закоментуйте в lib/tgBot.php у функції request() рядок $bot->botLog(...);  

Дуже рекомендую обов'язково відключити логування після дебагінгу  




Більше документації з приводу можливостей можна знайти в коментарях в lib/tgBot  
Приклад стартового, але функціонального та повністю робочого файлу **hook** можна знайти в 
**bots/hook.php**  
Цей стартовий файл **hook** гарно прокоментований і має багато готових рішень  

З коробки він:  
1. Вітається з користувачем
2. Зберігає надіслані йому файли
3. ...
4. ...


**Наприклад бот може**: 
```php
// Зберігати файли які хтось відправив боту чи публічний чат
$bot->saveFile($data['message']['photo'][1], $pathtosave);

// ...

```

**Бот може стати більш функціональним якщо Ви підключити його до MySQL бази данних та інсталюєте**  

Тоді бот зможе:
1. Зберігати унікальні для кожного боту налаштування (країну, адміністраторів, модераторів, контакти, сайт, ключовий tg канал тощо)
2. Пам'ятати користувачів та їх дані (контакти, піб, баланс, статус тощо)
3. Надавати користувачам різні ролі та відповідні можливості (адміністратор, модератор)
4. Надавати послуги або продавати товари
5. Пам'ятати останній важливий контекст діалогу (наприклад коли бот запитав номер телефону, він продовжує його чекати не дивлячись на деякі незначні метання та помилки користувача)
6. Автоматично додавати до постів на каналах кнопки чи посилання
7. Впроваджувати обмежений доступ до чатів (по підписці наприклад)
8. Автоматично виконувати дії в залежності від відповіді отриманої від Telegram API  

Точно такий же бот, який Ви отримаєте одразу після інсталяції  
[можна протестувати тут](https://t.me/TestHostingUa_bot)  

Створення функціонального візуального інтерфейсу для керування та налаштування бота не планується.  

Я надаю коробку якісно задокументованих готових рішеннь (класси, функції та методи) комбінуючи які,  виходячи з особистих потреб, можна зробити дуже функціональний бот, але робити це доведеться, через конструювання в php коді та налаштуванні через MySQL базу данних (PhpMyAdmin).  

**Для отримання базового боту потрібно:**  
1. Завантажити весь вміст теки lib, а також файли з кореня репозиторію
2. В кореневому файлі MysqlConnection.php треба вказати дані для доступу до бази данних
3. Змінити constants на свій смак в add.php (EMAIL,SERVICE_KEY,SERVICE_KEY_SOLD,SECURITY)
4. Виконати install.php
5. [webhook](../docs/setWebhook.ua.md) bots/base_hook.php

**Що саме встановлюється в базу данних для функціонування розширенного боту?**  
Перелік країн (table countries) з якими він може функціонально працювати. Наразі додано 11 країн (Україна,Great Britain,Грузія, Латвія, Таджикістан, Узбекістан)  
Перелік областей та всіх міст вищезазначених країн (в яких проживає більше 3-7 тисяч). Це дозволяє з коробки повноцінно надавати послуги або продавати товари в цих містах.  
В залежності від країни або мови користувача бот може обирати якою мовою відправляти повідомлення. Базово в бот закладена можливість вказути варіанти повідомлень на українській, англійській та російській (для десятків країн з великою російськомовною аудиторією).


**Poadmap**  
1. Доступ до чату по підписці
2. Додавання послуг, підписок чи товарів
3. Сплата послуги, підписки чи товару по номеру картки - полуавтоматичний p2p чи на BTC використовуючи унікальний холодний автоматичний процесінг платежів (нода не потрібна)!